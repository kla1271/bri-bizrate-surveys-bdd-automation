<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns="http://www.springframework.org/schema/beans"
       xsi:schemaLocation="
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context-3.0.xsd
       ">

    <bean id="deliveryServiceBaseUrl" class="java.lang.String">
        <constructor-arg value="${DELIVERY_SERVICE_ENDPOINT}"/>
    </bean>


    <bean id="localFileRdsCredentialsSupplier" class="com.bizrateinsights.rds.LocalFileRdsCredentialsSupplier">
        <constructor-arg index="0" value="${LOCAL_RDS_CREDENTIALS_FILE_PATH}"/>
    </bean>

    <bean id="amazonS3" class="com.amazonaws.services.s3.AmazonS3Client" />

    <bean id="s3RdsCredentialsSupplier" class="com.bizrateinsights.rds.S3RdsCredentialsSupplier">
        <constructor-arg index="0" ref="amazonS3"/>
        <constructor-arg index="1" value="${S3_CREDENTIALS_BUCKET}"/>
        <constructor-arg index="2" value="${S3_RDS_CREDENTIALS_KEY}"/>
    </bean>

    <bean id="environmentMappedRdsCredentialsSupplier" class="com.bizrateinsights.rds.EnvironmentMappedRdsCredentialsSupplier">
        <constructor-arg index="0" value="${ENVIRONMENT_NAME}"/>
        <constructor-arg index="1">
            <map key-type="com.bizrateinsights.rds.Environment">
                <entry key="DEFAULT" value-ref="localFileRdsCredentialsSupplier"/>
                <entry key="STAGE" value-ref="s3RdsCredentialsSupplier"/>
            </map>
        </constructor-arg>
    </bean>

    <bean id="rdsCredentials" class="com.bizrateinsights.rds.RdsCredentials" factory-bean="environmentMappedRdsCredentialsSupplier" factory-method="get" />

    <bean id="userName_rds" factory-bean="rdsCredentials" factory-method="getUserName"/>
    <bean id="password_rds" factory-bean="rdsCredentials" factory-method="getPassword"/>
    <bean id="driverClassName_rds" factory-bean="rdsCredentials" factory-method="getDriverClassName"/>
    <bean id="jdbcUrl_rds" factory-bean="rdsCredentials" factory-method="getJdbcUrl"/>

    <bean id="rdsDataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
        <property name="driverClassName" ref="driverClassName_rds"/>
        <property name="url" ref="jdbcUrl_rds"/>
        <property name="username" ref="userName_rds"/>
        <property name="password" ref="password_rds"/>
    </bean>

    <bean id="rdsJdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
        <property name="dataSource" ref="rdsDataSource" />
    </bean>
    <bean id="saucelabUsername" class="java.lang.String">
        <constructor-arg value="${SAUCELAB_USERNAME}"/>
    </bean>
    <bean id="saucelabAccessKey" class="java.lang.String">
        <constructor-arg value="${SAUCELAB_ACCESS_KEY}"/>
    </bean>
    <context:property-placeholder location="classpath:env.properties"/>
</beans>